<% @header_title = "CommitMiner User Study: #{@name}" %>

<% content_for :js_code do %>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<% end %>

<!--
<%= session.inspect.html_safe %>
-->

<div class="row well full-height">
    <div class="col-md-6 full-height">
        <iframe src="<%= @commit1 %>"></iframe>
    </div>

    <div class="col-md-6 full-height">
        <iframe src="<%= @commit2 %>"></iframe>
    </div>
</div>

<% form_tag url_for(:evaluations, :create), method: :post, id: 'evaluation-form' do %>

    <div class="row well align-center">
        <%= content_tag(:i, nil, :class => 'fa fa-bug fa-3x category', title: 'Root Cause Similarity') %>

        <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default unkown" title="I don't know enough to answer this">
                <input type="radio" name="bug-similarity" id="bug-0" autocomplete="off" value="0">
                <%= content_tag(:i, nil, :class => 'fa fa-question-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Very dissimilar">
                <input type="radio" name="bug-similarity" id="bug-m2" autocomplete="off" value="-2">
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Somehow dissimilar">
                <input type="radio" name="bug-similarity" id="bug-m1" autocomplete="off" value="-1">
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Somehow similar">
                <input type="radio" name="bug-similarity" id="bug+p1" autocomplete="off" value="1">
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Very similar">
                <input type="radio" name="bug-similarity" id="bug+p2" autocomplete="off" value="2">
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
            </label>
        </div>
    </div>

    <div class="row well align-center">
        <%= content_tag(:i, nil, :class => 'fa fa-wrench fa-3x category', title: 'Repair Similarity') %>

        <div class="btn-group" data-toggle="buttons">
            <label class="btn btn-default unkown"  title="I donâ€™t know enough to answer this">
                <input type="radio" name="repair-similarity" id="repair-0" autocomplete="off" value="0">
                <%= content_tag(:i, nil, :class => 'fa fa-question-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Very dissimilar">
                <input type="radio" name="repair-similarity" id="repair-m2" autocomplete="off" value="-2">
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Somehow dissimilar">
                <input type="radio" name="repair-similarity" id="repair-m1" autocomplete="off" value="-1">
                <%= content_tag(:i, nil, :class => 'fa fa-minus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Somehow similar">
                <input type="radio" name="repair-similarity" id="repair-p1" autocomplete="off" value="1">
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
            </label>
            <label class="btn btn-default" title="Very similar">
                <input type="radio" name="repair-similarity" id="repair-p2" autocomplete="off" value="2">
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
                <%= content_tag(:i, nil, :class => 'fa fa-plus-circle fa-3x') %>
            </label>
        </div>
    </div>
<% end %>


<div class="row well align-center">
    <div class="col-sm-8 col-sm-offset-2">
        <div class="progress">
            <div class="progress-bar progress-bar-striped" role="progressbar" style="width: <%= @progress %>%;"></div>
        </div>
    </div>
</div>

<% content_for :js_code do %>
    <script>
        $(document).ready(function() {
            $('iframe').on('load', function() {
                $('iframe').contents().find('.header, .pagehead.repohead, ' +
                        '.commit.full-commit, .site-footer-container, .file-info, #toc, #all_commit_comments').hide();

                $('iframe').contents().find('body.split-diff .container').css('padding-left', '0px');
            });

            $('iframe').trigger('load');

            // When buttons are clicked
            $('#evaluation-form').on('change', function() {
               // Check if both groups are filled
                var group1 = $('input[name=bug-similarity]:checked', '#evaluation-form').val();
                var group2 = $('input[name=repair-similarity]:checked', '#evaluation-form').val();

                // Submit form
                if (group1 && group2) {
                    $('#evaluation-form').submit();
                }
            });
        });
    </script>
<% end %>

<style>
    html, body, .container, .full-height {
        height: 100%;
    }

    iframe {
        height: 100%;
        width: 100%;
        border: 1px dashed gray;
    }

    .align-center {
        text-align: center;
    }

    .unkown { margin-right: 50px; }
    .btn { width: 100px; }

    .fa.category {
        vertical-align: middle;
        margin-right: 50px;
    }

    .btn.active {
        border: 2px dashed gray;
    }
</style>